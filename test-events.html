<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Formeo Events Test</title>
  <link rel="stylesheet" href="./dist/formeo.min.css">
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
    }
    #editor-container {
      min-height: 400px;
      border: 1px solid #ccc;
      margin: 20px 0;
    }
    #event-log {
      background: #f5f5f5;
      padding: 10px;
      border: 1px solid #ddd;
      max-height: 300px;
      overflow-y: auto;
      font-family: monospace;
      font-size: 12px;
    }
    .event-entry {
      padding: 5px;
      margin: 2px 0;
      border-left: 3px solid #007bff;
      background: white;
    }
    .event-config {
      border-left-color: #28a745;
    }
    .event-dom {
      border-left-color: #ffc107;
    }
    h2 {
      margin-top: 30px;
    }
  </style>
</head>
<body>
  <h1>Formeo Events Test</h1>
  
  <p>This page tests both event callback approaches:</p>
  <ul>
    <li><strong style="color: #28a745;">Green</strong> = Configuration callbacks (events option)</li>
    <li><strong style="color: #ffc107;">Orange</strong> = DOM event listeners (addEventListener)</li>
  </ul>

  <div id="editor-container"></div>

  <h2>Event Log</h2>
  <button onclick="clearLog()">Clear Log</button>
  <div id="event-log"></div>

  <script type="module">
    import { FormeoEditor } from './dist/formeo.min.es.js'

    const eventLog = document.getElementById('event-log')
    
    function logEvent(source, eventType, eventData) {
      const entry = document.createElement('div')
      entry.className = `event-entry event-${source}`
      const timestamp = new Date().toLocaleTimeString()
      entry.innerHTML = `
        <strong>[${timestamp}] ${source.toUpperCase()}: ${eventType}</strong><br>
        ${JSON.stringify({
          changePath: eventData.detail?.changePath || eventData.changePath,
          value: eventData.detail?.value || eventData.value,
          changeType: eventData.detail?.changeType || eventData.changeType
        }, null, 2)}
      `
      eventLog.insertBefore(entry, eventLog.firstChild)
    }

    window.clearLog = function() {
      eventLog.innerHTML = ''
    }

    // Test 1: Configuration callbacks
    const editor = new FormeoEditor({
      editorContainer: '#editor-container',
      events: {
        onChange: (evt) => {
          logEvent('config', 'onChange', evt)
        },
        onUpdate: (evt) => {
          logEvent('config', 'onUpdate', evt)
        },
        onUpdateField: (evt) => {
          logEvent('config', 'onUpdateField', evt)
        },
        onUpdateRow: (evt) => {
          logEvent('config', 'onUpdateRow', evt)
        },
        onUpdateColumn: (evt) => {
          logEvent('config', 'onUpdateColumn', evt)
        },
        onUpdateStage: (evt) => {
          logEvent('config', 'onUpdateStage', evt)
        }
      }
    })

    // Test 2: DOM event listeners
    document.addEventListener('formeoUpdated', (evt) => {
      logEvent('dom', 'formeoUpdated', evt)
    })

    document.addEventListener('formeoChanged', (evt) => {
      logEvent('dom', 'formeoChanged', evt)
    })

    document.addEventListener('formeoUpdatedField', (evt) => {
      logEvent('dom', 'formeoUpdatedField', evt)
    })

    document.addEventListener('formeoUpdatedRow', (evt) => {
      logEvent('dom', 'formeoUpdatedRow', evt)
    })

    document.addEventListener('formeoUpdatedColumn', (evt) => {
      logEvent('dom', 'formeoUpdatedColumn', evt)
    })

    document.addEventListener('formeoUpdatedStage', (evt) => {
      logEvent('dom', 'formeoUpdatedStage', evt)
    })

    console.log('Formeo editor initialized with event listeners')
  </script>
</body>
</html>
